/*! BingMapFFDraw - v0.0.1 - 2013-06-12
* https://github.com/dannyrscott/BingMapFreeFormDraw
* Copyright (c) 2013 Danny Scott; Licensed MIT */
(function(n){"use strict";var t=function(n,t){var e,o,i,r=n,a=Microsoft.Maps,s=new a.EntityCollection,c=new a.Polyline,u=[],d=new a.Polygon,v=!1,l=t||{};l.onDrawEnd=l.onDrawEnd||function(){},r.entities.push(s),s.push(c),s.push(d);var f=function(){t=t||{};var n=t.onDrawEnd||function(){};v||(v=!0,d.setLocations([]),e=a.Events.addThrottledHandler(r,"mousemove",function(n){u=c.getLocations()||[];var t,e=new a.Point(n.getX(),n.getY());try{t=n.target.tryPixelToLocation(e)}catch(o){t=!1}t&&(u.push(t),c.setLocations(u))},100),o=a.Events.addHandler(r,"click",function(){h(n),a.Events.removeHandler(o)}))},h=function(){a.Events.removeHandler(e);var n=c.getLocations();n.length&&n.push(n[0]),c.setLocations([]),d.setLocations(n),v=!1,l.onDrawEnd()};this.enterDrawingMode=function(){i=a.Events.addHandler(r,"click",function(){a.Events.removeHandler(i),f()})},this.endDrawingMode=function(){a.Events.removeHandler(i),v&&(v=!1,h())},this.getShape=function(){return d},this.getLayer=function(){return s}};n.BingDrawFF=t})("object"==typeof exports&&exports||this);