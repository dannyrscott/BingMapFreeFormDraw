/*! BingMapFFDraw - v0.0.1 - 2013-06-12
* https://github.com/dannyrscott/BingMapFreeFormDraw
* Copyright (c) 2013 Danny Scott; Licensed MIT */
(function(n){"use strict";var t=function(n){var t,e,o,i=n,r=Microsoft.Maps,s=new r.EntityCollection,a=new r.Polyline,c=[],u=new r.Polygon,d=!1;i.entities.push(s),s.push(a),s.push(u);var v=function(n){n=n||{};var o=n.onDrawEnd||function(){};d||(d=!0,u.setLocations([]),t=r.Events.addThrottledHandler(i,"mousemove",function(n){c=a.getLocations()||[];var t,e=new r.Point(n.getX(),n.getY());try{t=n.target.tryPixelToLocation(e)}catch(o){t=!1}t&&(c.push(t),a.setLocations(c))},100),e=r.Events.addHandler(i,"click",function(){l(o),r.Events.removeHandler(e)}))},l=function(n){n=n||function(){},r.Events.removeHandler(t);var e=a.getLocations();e.length&&e.push(e[0]),a.setLocations([]),u.setLocations(e),d=!1,n()};this.enterDrawingMode=function(n){o=r.Events.addHandler(i,"click",function(){r.Events.removeHandler(o),v(n)})},this.endDrawingMode=function(){r.Events.removeHandler(o),d&&(d=!1,l())},this.getShape=function(){return u},this.getLayer=function(){return s}};n.BingDrawFF=t})("object"==typeof exports&&exports||this);