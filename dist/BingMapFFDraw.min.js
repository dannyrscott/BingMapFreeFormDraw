/*! BingMapFFDraw - v0.0.1 - 2013-06-13
* https://github.com/dannyrscott/BingMapFreeFormDraw
* Copyright (c) 2013 Danny Scott; Licensed MIT */
(function(n){"use strict";var t=function(n,t){var e,o,i,r,s=n,a=this,c=Microsoft.Maps,u=new c.EntityCollection,d=new c.Polyline,l=[],g=!1,v=!1,f=t||{};f.onDrawEnd=f.onDrawEnd||function(){},f.polygon=f.polygon||{},e=new c.Polygon(null,f.polygon),s.entities.push(u),u.push(d),u.push(e);var h=function(){t=t||{};var n=t.onDrawEnd||function(){};g||(g=!0,e.setLocations([]),o=c.Events.addThrottledHandler(s,"mousemove",function(n){l=d.getLocations()||[];var t,e=new c.Point(n.getX(),n.getY());try{t=n.target.tryPixelToLocation(e)}catch(o){t=!1}t&&(l.push(t),d.setLocations(l))},100),i=c.Events.addHandler(s,"click",function(){w(n),c.Events.removeHandler(i),a.endDrawingMode()}))},w=function(){c.Events.removeHandler(o);var n=d.getLocations();n.length&&n.push(n[0]),d.setLocations([]),e.setLocations(n),g=!1,f.onDrawEnd()};this.enterDrawingMode=function(){v||(v=!0,r=c.Events.addHandler(s,"click",function(){c.Events.removeHandler(r),h()}))},this.endDrawingMode=function(){v=!1,c.Events.removeHandler(r),g&&(g=!1,w())},this.inDrawingMode=function(){return v},this.isDrawing=function(){return g},this.getShape=function(){return e},this.getLayer=function(){return u}};n.BingDrawFF=t})("object"==typeof exports&&exports||this);