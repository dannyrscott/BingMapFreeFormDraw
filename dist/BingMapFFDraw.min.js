/*! BingMapFFDraw - v0.0.1 - 2013-06-12
* https://github.com/dannyrscott/BingMapFreeFormDraw
* Copyright (c) 2013 Danny Scott; Licensed MIT */
(function(n){"use strict";var t=function(n,t){var e,o,i,r,a=n,s=Microsoft.Maps,c=new s.EntityCollection,u=new s.Polyline,l=[],d=!1,v=t||{};v.onDrawEnd=v.onDrawEnd||function(){},v.polygon=v.polygon||{},e=new s.Polygon(null,v.polygon),a.entities.push(c),c.push(u),c.push(e);var f=function(){t=t||{};var n=t.onDrawEnd||function(){};d||(d=!0,e.setLocations([]),o=s.Events.addThrottledHandler(a,"mousemove",function(n){l=u.getLocations()||[];var t,e=new s.Point(n.getX(),n.getY());try{t=n.target.tryPixelToLocation(e)}catch(o){t=!1}t&&(l.push(t),u.setLocations(l))},100),i=s.Events.addHandler(a,"click",function(){g(n),s.Events.removeHandler(i)}))},g=function(){s.Events.removeHandler(o);var n=u.getLocations();n.length&&n.push(n[0]),u.setLocations([]),e.setLocations(n),d=!1,v.onDrawEnd()};this.enterDrawingMode=function(){r=s.Events.addHandler(a,"click",function(){s.Events.removeHandler(r),f()})},this.endDrawingMode=function(){s.Events.removeHandler(r),d&&(d=!1,g())},this.getShape=function(){return e},this.getLayer=function(){return c}};n.BingDrawFF=t})("object"==typeof exports&&exports||this);